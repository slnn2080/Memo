### CDN
> 场景说明
- 比如我们要买火车票 在没有代售点的时候 我们会去火车站买票
- 如果家离火车站很远 那么买票所花费的时间就会很长
- 当家楼下出现火车票代售点的时候 那是不是买火车票这个过程就方便了很多

> 什么是CDN
- CDN也叫内容分发网络，是一个经策略性部署的整体系统，包括分4个要件。

  布式存储
  负载均衡
  网络请求的重定向
  内容管理

- 而其中呢，内容管理和全局的网络流量管理是CDN的核心所在。
- 通过用户就进行和服务器负载的判断，CDN确保内容以一种极为高效的方式为用户的请求提供服务


> 为什么要使用cdn引入公共模块 ？
- 客户端直接从源站点获取数据，当服务器访问量大时会影响访问速度，进而影响用户体验，且无法保证客户端与源站点间的距离足够短，并且适合传输数据。


> 有cdn和没有cdn的区别是什么？
- 没有cdn:

- -->用户在浏览器访问栏中输入要访问的域名;

- -->浏览器向DNS服务器请求对该域名的解析;

- -->DNS服务器返回该域名的IP地址给浏览器;

- -->浏览器使用该IP地址向服务器请求内容;

- -->服务器将用户请求的内容返回给浏览器;

---

- 有cdn：

- -->用户在浏览器中输入要访问的域名

- -->浏览器向DNS服务器请求对域名进行解析。由于CDN对域名解析进行了调整，DNS服务器会最终 将域名的解析权交给CNAME指向的CDN专用DNS服务器

- -->CDN的DNS服务器将CDN的负载均衡设备IP地址返回给用户

- -->用户向CDN的负载均衡设备发起内容URL访问请求

- -->CDN负载均衡设备会为用户选择一台合适的缓存服务器提供服务
<!-- 
  选择的依据包括：
    根据用户IP地址，判断哪一台服务器距离用户最近；
    根据用户所请求的URL中携带的内容名称，判断哪一台服务器上有用户所需内容；
    查询各个服务器的负载情况，判断哪一台服务器的负载较小,基于以上这些依据的综合分析之后，负载均衡设置会把缓存服务器的IP地址返回给用户
 -->

- -->用户向缓存服务器发出请求
- -->缓存服务器响应用户请求，将用户所需内容传送到用户
- -->如果这台缓存服务器上并没有用户想要的内容，而负载均衡设备依然将它分配给了用户，那么这台服务器就要向它的上一级缓存服务器请求内容，直至追溯到网站的源服务器将内容拉取到本地


> 关于缓存
- 没有CDN：浏览器缓存
- 使用了CDN：浏览器缓存+CDN缓存

- 在用户第一次访问网站后，网站的一些静态资源如图片等就会被下载到本地，作为缓存，当用户第二次访问该网站的时候，浏览器就会从缓存中加载资源，不用向服务器请求资源，从而提高了网站的访问速度，

- 而若使用了CDN，当浏览器本地缓存的资源过期之后，浏览器不是直接向源站点请求资源，而是向CDN边缘节点请求资源，CDN边缘节点中也存在缓存，若CDN中的缓存也过期，那就由CDN边缘节点向源站点发出回源请求来获取最新资源。

- 浏览器在加载资源时，先根据这个资源的一些http header判断它是否命中强缓存，如果命中，浏览器直接从自己的缓存中读取资源，不会发请求到服务器，当强缓存没有命中的时候，浏览器一定会发送一个请求到服务器，服务器端依据资源的另外一些http header验证这个资源是否命中协商缓存，如果命中，服务器会将这个请求返回，但是不会返回这个资源的数据，而是告诉客户端可以直接从缓存中加载这个资源，于是浏览器还是从自己的缓存中加载资源，当协商缓存也没有命中的时候，浏览器直接从服务器加载资源数据

- CDN节点缓存机制在不同服务商中是不同的，但一般都遵循HTTP协议，通过http响应头中的Cache-Control:max-age的字段来设置CDN节点文件缓存时间。当客户端向CDN节点请求数据时，CDN会判断缓存数据是否过期，若没有过期，则直接将缓存数据返回给客户端，否则就向源站点发出请求，从源站点拉取最新数据，更新本地缓存，并将最新数据返回给客户端。CDN服务商一般会提供基于文件后缀、目录多个维度来指定CDN缓存时间，为用户提供更精细化的缓存管理。CDN缓存时间会对“回源率”产生直接的影响，若CDN缓存时间短，则数据经常失效，导致频繁回源，增加了源站的负载，同时也增大了访问延时；若缓存时间长，数据更新时间慢，因此需要针对不同的业务需求来选择特定的数据缓存管理。


> 采用cdn引入公共组件的优点

- 1. 多域名加载资源
- 一般情况下，浏览器都会对单个域名下的并发请求数（文件加载）进行限制，通常最多有4个，那么第5个加载项将会被阻塞，直到前面的某一个文件加载完毕。
- 因为CDN文件是存放在不同区域（不同IP）的，所以对浏览器来说是可以同时加载页面所需的所有文件（远不止4个），从而提高页面加载速度。

- 2. 文件可能已经被加载过并保存有缓存
- 一些通用的js库或者是css样式库，如jQuery，在网络中的使用是非常普遍的。当一个用户在浏览你的某一个网页的时候，很有可能他已经通过你网站使用的CDN访问过了其他的某一个网站，恰巧这个网站同样也使用了jQuery，那么此时用户浏览器已经缓存有该jQuery文件（同IP的同名文件如果有缓存，浏览器会直接使用缓存文件，不会再进行加载），所以就不会再加载一次了，从而间接的提高了网站的访问速度。

- 3. 高效率
- 你的网站做的再NB也不会NB过百度NB过Google吧？一个好的CDN会提供更高的效率，更低的网络延时和更小的丢包率。

- 4. 分布式的数据中心
- 假如你的站点布置在北京，当一个香港或者更远的用户访问你的站点的时候，他的数据请求势必会很慢很慢。而CDNs则会让用户从离他最近的节点去加载所需的文件，所以加载速度提升就是理所当然的了。

- 5. 内置版本控制
- 通常，对于CSS文件和JavaScript库来说都是有版本号的，你可以通过特定版本号从CDNs加载所需的文件，也可以使用latest加载最新版本（不推荐）。

- 6. 使用情况分析
- 一般情况下CDNs提供商（如百度云加速）都会提供数据统计功能，可以了解更多关于用户访问自己网站的情况，可以根据统计数据对自己的站点适时适当的做出些许调整。

- 7. 有效防止网站被攻击
- 一般情况下CDNs提供商也是会提供网站安全服务的。


> 采用cdn引入公共组件的缺点
- 硬核：必须依赖网络，如果没网，cdn的资源什么都回不来，可能导致页面崩塌。
