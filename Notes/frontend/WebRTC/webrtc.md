### WebRTC
- 它历经5代跨域25年的RTC架构演化史
- 第一代: MCU阶段
- 第二代: P2P阶段
- 第三代: 单SFU阶段
- 第四代: 云SFU阶段
- 第五代: 全球实时云通信阶段(2016至今)

- webrtc不全是前端技术 如果我们想在浏览器这边实现音视频通话 需要使用webrtc
<!--  
  其他的技术在音视频通话的时候可能需要安装插件
  但是使用webrtc技术的话 是不需要安装插件的
 -->

- webrtc是H5标准之一 直接调用api就可以

> webRTC分为客户端 和 服务器端
- 客户端:
- web客户端:  
  也就是浏览器应用webrtc技术 因为是h5标准 所以可以直接调用api

- window/linux PC:
  我们可以应用 webrtc源码包(源码包本身是C) 但要用到 C++ 技术

- 移动端:
  anfroid - 安卓它有java接口 java中提供了官方的rtc的库
  ios     - ios它有object接口 object中提供了官方的rtc的库
<!-- 
  webrtc源码包 它是做客户端的
 -->  

---

- 服务器端:
- 这边要是使用 webrtc 技术 需要应用特别多的技术 如
- SRS Licode Janus Kurentos
- 服务端遵循webRTC协议实现服务端

---

> 音视频通话原理
> 问题:
- 两边通话怎么发现对方?

> 解答:
- 1. 客户端与服务器(信令服务器)链接 需要信令服务器支持
<!-- 
  信令服务器:
    比如我们有两个客户端 A B
    不管是A还是B 都需要连接到服务器 也就是说 两台客户端都需要连接服务器
 -->

- 2. 房间的概念
- 两个人要是通话 我们需要在一个频道里面 所以两个人通话要加入到同样的房间
- 比如 A 和 B 都加入到 room id: 1000 的房间
- 这是 A发送的信息 在服务器里 可以转发给同房间的人

---

> 问题:
- 怎么编码？ 音视频媒体协商

> 解答:
- 音视频传输 发送方发送之前需要编码 接受方接受之前需要解码 要解码后才能显示
- 比如摄像头数据编码为 H264
- 
<!-- 
    A: 拥有 VP8 和 H264 编码的能力
    B: 拥有 VP9 和 H264 编码的能力

      A
      -----------------
      |               |         B
      |     ----------|----------
      |      |        |          |
      |      |        |          |
      |  VP8 | H264   |          |
      |      |        |          |
      |      |        |          |
      |      |   H264 |  VP9     |
      |      |        |          |
      |------|---------          |
             |                   |
             --------------------
-->

- 如果A传递数据是使用 VP8 进行编码 但是B没有 VP8 就不能解码
- 那怎么办？

- A告诉B 自己支持 VP8 H264 告诉B
- B告诉A 自己支持 VP9 H264 告诉A

- 这样两者都知道对方的编解码能力 这样可以选择共同的编码能力 H264

> 媒体协商
- 像上面的过程叫做媒体协商 会被封装到 SDP 协议里面
- 该协议可用于这类信息在webrtc中 *参与视频通讯的双方必须先交换SDP信息* 这样双方才能知根知底 而交换SDP的过程 *叫做媒体协商*


> 网络协商
- 除了双方要彼此了解对方的编解码能力 同时也要了解对方的网络情况 这样才有可能找到一条相互通讯的链路

- 理想的网络情况是每个浏览器的电脑都是*私有公网IP* 可以直接进行点对点连接

<!-- 

              信令服务器

           ↙           ↘

     A                      B
192.168.2.219    →    192.168.2.219 
 -->

- 怎么发送数据给对方?
- 两个人在同一局域网的情况下 可以用局域网的ip 如果两个人不在同一个局域网肯定不行

- p2p:
- 如果 A 可以把数据 直接发给 B 点对点 不经过服务器 那么就是p2p

- 但是实际的情况是 AB 双方是不能点对点通信的
- 我们可以在百度上搜索 IP 能查看到 外网的ip地址 (我们往外发送数据肯定是有外网ip的 接受数据的也是从公网转到内网)

- 本机IP: 60.68.140.12日本东京 BBTEC

<!-- 

              信令服务器

           ↙           ↘

     A                      B
192.168.2.219  |     |  192.168.2.219 
公网:                    公网:
60.68.140.12            78.68.188.19

 -->

- 局域网发送数据到 NAT网关 由网关到公网
- P2P:
- 获取 STUN 的协议 获取局域网 IP + PORT 在NAT设备在外网的 IP + PORT 彼此将NAT外网信息发送给对方 如果能够连接上就是 P2P

- 如果P2P不成功 那么就会用到 *TURN协议转发* 商业方案很少采用P2P方案

- 商业方案一般采用 通过服务器转发的话 但是消耗服务器的带宽的(耗钱)

- candidate是封装网络信息的
